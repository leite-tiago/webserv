# Webserv Configuration File
# Syntax similar to nginx

# Server 1 - Main website on port 8080
server {
	listen 8080;
	host 127.0.0.1;
	server_name localhost webserv.local;

	client_max_body_size 10M;

	# Custom error pages
	error_page 404 /errors/404.html;
	error_page 500 /errors/500.html;

	# Root location
	location / {
		root ./www;
		index index.html index.htm;
		allow_methods GET POST DELETE;
		autoindex off;
	}

	# Static files
	location /static {
		root ./www/static;
		allow_methods GET;
		autoindex on;
	}

	# Upload directory
	location /upload {
		root ./www/uploads;
		allow_methods GET POST DELETE;
		upload_enable on;
		upload_path ./www/uploads;
		autoindex on;
	}

	# Test endpoint - for forms, query strings, etc
	location /test {
		root ./www;
		allow_methods GET POST DELETE;
		autoindex off;
	}

	# CGI for PHP files
	location /cgi-bin {
		root ./www/cgi-bin;
		allow_methods GET POST;
		cgi_pass /usr/bin/php-cgi;
		cgi_ext .php;
	}

	# Redirect example
	location /redirect {
		return http://www.example.com;
	}
}

# Server 2 - Another server on port 8081
server {
	listen 8081;
	host 127.0.0.1;
	server_name test.local;

	client_max_body_size 5M;

	error_page 404 /404.html;

	location / {
		root ./www2;
		index index.html;
		allow_methods GET;
		autoindex on;
	}
}

# Server 3 - Multiple ports
server {
	listen 8080;
	listen 8082;
	host 0.0.0.0;
	server_name api.local;

	client_max_body_size 1M;

	location / {
		root ./api;
		allow_methods GET POST DELETE;
		autoindex off;
	}

	location /python {
		root ./api/python;
		allow_methods GET POST;
		cgi_pass /usr/bin/python3;
		cgi_ext .py;
	}
}
